pl <- ggplot(df2, aes(x = x
, next_x = next_x
, node = node
, next_node = next_node
, fill =node
,label = paste0(node, " = ", n))
)
pl <- pl +geom_sankey(flow.alpha = 0.5
, node.color = NA
,show.legend = F)
pl <- pl +geom_sankey_text(size =5, color = "black", fill = NA, hjust = 0,
position = position_nudge(x = 0.08))
pl <- pl +  theme_alluvial()
pl <- pl + theme(legend.position = "none")
#pl <- pl +  theme(axis.title = element_blank()
# , axis.text.y = element_blank()
#, axis.ticks = element_blank()
# , panel.grid = element_blank())
cols <- hcl.colors(31, "Sunset")
pl <- pl + scale_fill_manual(values=cols)
pl
data <- read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARC_analysis/mycolicibacterium/Contig taxa conc.xlsx",sheet=3,rowNames = F)
library(openxlsx)
library(GGally)
library(tidyverse)
data <- read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARC_analysis/mycolicibacterium/Contig taxa conc.xlsx",sheet=3,rowNames = F)
#data transform----------------------------------------
data <-data%>%
separate(corrtest,into=c("n","type"),sep="__")%>%
column_to_rownames(var = "type")%>%
select(-n)%>%
t()%>%
as.data.frame()
#single group plot----------------------------
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(color="#BEBADA",alpha=0.7,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,color="#BEBADA")
p
}
diag_fn <- function(data, mapping, ...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.7,fill="#BEBADA",color="#BEBADA")
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping,size=7)
}
}
#ggpairs
x<-ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn)),
upper = list(continuous=wrap(upper_fn)))+
theme_bw()+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
x
color<-hcl.colors(3,"sunset")
color
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(color="#704D9E",alpha=0.5,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,color="#704D9E")
p
}
diag_fn <- function(data, mapping, ...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.5,fill="#704D9E",color="#704D9E")
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping,size=7)
}
#single group plot----------------------------
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(color="#704D9E",alpha=0.5,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,color="#704D9E")
p
}
diag_fn <- function(data, mapping, ...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.5,fill="#704D9E",color="#704D9E")
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping,size=7)
}
}
#ggpairs
x<-ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn)),
upper = list(continuous=wrap(upper_fn)))+
theme_bw()+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
x
#ggsave("plot.pdf",x, width = 20, height = 13)
#two group plot-------------------------------------------------------------------------
data$group <-c("Raw","Raw","Raw","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW")
data<-as.data.frame(data)
data$group<-factor(data$group,levels = c("Raw","DW"))
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.7,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.7,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#704D9E" ,"#ED7C97")
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.5,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.5,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.5,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#704D9E" ,"#ED7C97")
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
color<-c("#704D9E" ,"#F3E79A")
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
color<-c( "#F3E79A","#704D9E")
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
color<-c("#F3E79A","#ED7C97","#704D9E" )
#multi group plot--------------------------------------------------
data$group <-c("Raw","Raw","Raw","Finished","Finished","Finished","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS")
data<-as.data.frame(data)
data$group<-factor(data$group,levels = c("Raw","Finished","DWDS"))
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.5,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.5,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.5,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#F3E79A","#ED7C97","#704D9E" )
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
library(openxlsx)
library(GGally)
library(tidyverse)
data <- read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARC_analysis/mycolicibacterium/Contig taxa conc.xlsx",sheet=3,rowNames = F)
#data transform----------------------------------------
data <-data%>%
separate(corrtest,into=c("n","type"),sep="__")%>%
column_to_rownames(var = "type")%>%
select(-n)%>%
t()%>%
as.data.frame()
#single group plot----------------------------
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(color="#BEBADA",alpha=0.7,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,color="#BEBADA")
p
}
diag_fn <- function(data, mapping, ...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.7,fill="#BEBADA",color="#BEBADA")
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping,size=7)
}
}
#ggpairs
x<-ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn)),
upper = list(continuous=wrap(upper_fn)))+
theme_bw()+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
x
#ggsave("plot.pdf",x, width = 20, height = 13)
#two group plot-------------------------------------------------------------------------
data$group <-c("Raw","Raw","Raw","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW")
data<-as.data.frame(data)
data$group<-factor(data$group,levels = c("Raw","DW"))
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.7,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.7,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#80B1D3","#BEBADA" )
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
#multi group plot--------------------------------------------------
data$group <-c("Raw","Raw","Raw","Finished","Finished","Finished","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS","DWDS")
data<-as.data.frame(data)
data$group<-factor(data$group,levels = c("Raw","Finished","DWDS"))
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.7,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.7,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#FB8072","#80B1D3","#BEBADA" )
hcl.colors(5,"sunset")
hcl.colors(3,"sunset")
color<-c("#F9B282","#ED7C97","#704D9E" )
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.5,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.5,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.5,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#F9B282","#ED7C97","#704D9E" )
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.6,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.6,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
library(openxlsx)
library(GGally)
library(tidyverse)
data <- read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARC_analysis/mycolicibacterium/Contig taxa conc.xlsx",sheet=3,rowNames = F)
#data transform----------------------------------------
data <-data%>%
separate(corrtest,into=c("n","type"),sep="__")%>%
column_to_rownames(var = "type")%>%
select(-n)%>%
t()%>%
as.data.frame()
#ggsave("plot.pdf",x, width = 20, height = 13)
#two group plot-------------------------------------------------------------------------
data$group <-c("Raw","Raw","Raw","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW","DW")
data<-as.data.frame(data)
data$group<-factor(data$group,levels = c("Raw","DW"))
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.5,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.5,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#ED7C97","#704D9E")
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
#plot function
{
lower_fn <- function(data, mapping, ...){
p <- ggplot(data = data, mapping = mapping) +
geom_point(aes(color=group),alpha=0.6,size=2) +
geom_smooth(method =lm,alpha=0.3,size=0.7,aes(color=group),fill="gray")+
scale_color_manual(values=color)
p
}
diag_fn <- function(data, mapping,group,...) {
ggplot(data = data,
mapping = mapping) +
geom_density(...,alpha=0.6,aes(fill=group))
}
upper_fn<- function(data, mapping,...) {
ggally_cor(data = data,
mapping = mapping)
}
}
RColorBrewer::brewer.pal(12,"Set3")
color<-c("#F9B282","#704D9E")
ggpairs(data, lower = list(continuous = wrap(lower_fn, method="lm")),
diag = list(continuous=wrap(diag_fn))
,ggplot2::aes(color=group))+
theme_bw()+
scale_fill_manual(values=color)+
scale_color_manual(values=color)+
theme(strip.text.x = element_text ( size = 12),
strip.text.y = element_text ( size = 12),
strip.text = element_text(face = "italic"))
library(tidyverse)
library(openxlsx)
library(vegan)
#importing the file and parsing the file correctly
# Replace the kraken_final name to the actual filename.
Data=read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/species_abundane_table(reads).xlsx",sheet=1,colNames = T,rowNames = T)
Data_t=as.data.frame(t(Data))
#importing the file and parsing the file correctly
# Replace the kraken_final name to the actual filename.
Data=read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rarefaction/kraken2_mapout_bacteria_reads.xlsx",sheet=1,colNames = T,rowNames = T)
Data_t=as.data.frame(t(Data))
#count the number of species
S <- specnumber(Data_t)
raremax <-min(rowSums(Data_t))
#Rarefaction of the samples
Srare <- rarefy(Data_t, raremax)
Srare
#plotting the rarefaction curves
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
pdf("Rarefaction_curve.pdf")
rarecurve(Data_t, step =10000, sample = raremax, col = "blue", cex = 0.4)
dev.off()
#importing the file and parsing the file correctly
# Replace the kraken_final name to the actual filename.
Data=read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rarefaction/kraken2_mapout_bacteria_reads.xlsx",sheet=1,colNames = T,rowNames = T)
Data_t=as.data.frame(t(Data))
#importing the file and parsing the file correctly
# Replace the kraken_final name to the actual filename.
Data=read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rarefaction/species_abundane_table_for rarefaction.xlsx",sheet=1,colNames = T,rowNames = T)
Data_t=as.data.frame(t(Data))
#count the number of species
S <- specnumber(Data_t)
raremax <-min(rowSums(Data_t))
#Rarefaction of the samples
Srare <- rarefy(Data_t, raremax)
Srare
#plotting the rarefaction curves
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
pdf("Rarefaction_curve.pdf")
rarecurve(Data_t, step =10000, sample = raremax, col = "blue", cex = 0.4)
dev.off()
library(tidyverse)
library(openxlsx)
library(vegan)
#importing the file and parsing the file correctly
# Replace the kraken_final name to the actual filename.
Data=read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rarefaction/species_abundane_table_for rarefaction.xlsx",sheet=1,colNames = T,rowNames = T)
Data_t=as.data.frame(t(Data))
#count the number of species
S <- specnumber(Data_t)
raremax <-min(rowSums(Data_t))
#Rarefaction of the samples
Srare <- rarefy(Data_t, raremax)
Srare
#plotting the rarefaction curves
plot(S, Srare, xlab = "Observed No. of Species", ylab = "Rarefied No. of Species")
abline(0, 1)
pdf("Rarefaction_curve.pdf")
rarecurve(Data_t, step =10000, sample = raremax, col = "blue", cex = 0.4)
dev.off()
