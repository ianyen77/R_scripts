scale_fill_manual(values = color)+scale_color_manual(values=color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.75,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(value=color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
color<-c("#8DD3C7" ,"#FFFFB3" ,"#BEBADA" ,"#80B1D3","#FB8072")
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.75,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(value=color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.75,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = =color)+theme_bw()+
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.75,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))+
geom_text(aes(x=Sample,y=abundance, label = paste0(abundance ,"%")),
size=4)
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=12),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=11.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=11),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.9,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Phyla,color=Phyla),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
View(data)
View(data)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data$Family<-gsub(pattern = "f__",replacement = "",x=data$Phyla)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data$Family<-gsub(pattern = "f__",replacement = "",x=data$Family)
rownames(data)<-data$Family
data$Family<-NULL
View(data)
data[data<0.01]<-0
data_sum<-apply(data,2,sum)
dd<-1-data_sum
data2<-rbind(data,dd)
rownames(data2)[nrow(data2)]<-"Others"
data3<-data2[apply(data2, 1, function(x) !all(x==0)),]
data3$Family<-rownames(data3)
View(data3)
rownames(data3)<-NULL
data4<-gather(data =data3, key ="Sample",value = "abundance",1:15)
data5<-data4[-which(data4$abundance==0),]
Sample<-colnames(data2)
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data$Family<-gsub(pattern = "f__",replacement = "",x=data$Family)
rownames(data)<-data$Family
data$Family<-NULL
data[data<0.05]<-0
data_sum<-apply(data,2,sum)
dd<-1-data_sum
data2<-rbind(data,dd)
rownames(data2)[nrow(data2)]<-"Others"
data3<-data2[apply(data2, 1, function(x) !all(x==0)),]
data3$Family<-rownames(data3)
#data3$phyla<-factor(data3$phyla,levels = c("Actinobacteria","Firmicutes","Planctomycetota","Proteobacteria","Others"))
rownames(data3)<-NULL
data3$Family<-factor(data3$Family,levels=c("Actinobacteria","Firmicutes","Planctomycetota","Proteobacteria","Others"))
data4<-gather(data =data3, key ="Sample",value = "abundance",1:15)
data5<-data4[-which(data4$abundance==0),]
Sample<-colnames(data2)
Location<-c("Raw","Raw","Raw","Finished","Finished","Finished","Upstream","Upstream","Upstream","Midstream","Midstream","Midstream","Downstream","Downstream","Downstream")
group<-data.frame(cbind(Sample,Location))
group$Location<-factor(group$Location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
#分組圖
group_by(Phyla,Location)%>%
ggplot()+geom_bar(aes(x=Location,y=avg,fill=Family,color=Family,alpha=0.8,stat="identity")+scale_fill_manual(values  = color)+scale_color_manual(values = color)+theme_bw()+
data_stat
#each sample plot
ggplot(data5)+
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data$Family<-gsub(pattern = "f__",replacement = "",x=data$Family)
rownames(data)<-data$Family
data$Family<-NULL
data[data<0.05]<-0
data_sum<-apply(data,2,sum)
dd<-1-data_sum
data2<-rbind(data,dd)
rownames(data2)[nrow(data2)]<-"Others"
data3<-data2[apply(data2, 1, function(x) !all(x==0)),]
data3$Family<-rownames(data3)
#data3$phyla<-factor(data3$phyla,levels = c("Actinobacteria","Firmicutes","Planctomycetota","Proteobacteria","Others"))
rownames(data3)<-NULL
data4<-gather(data =data3, key ="Sample",value = "abundance",1:15)
data5<-data4[-which(data4$abundance==0),]
Sample<-colnames(data2)
Location<-c("Raw","Raw","Raw","Finished","Finished","Finished","Upstream","Upstream","Upstream","Midstream","Midstream","Midstream","Downstream","Downstream","Downstream")
group<-data.frame(cbind(Sample,Location))
group$Location<-factor(group$Location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
#分組圖
group_by(Phyla,Location)%>%
ggplot()+geom_bar(aes(x=Location,y=avg,fill=Family,color=Family,alpha=0.8,stat="identity")+scale_fill_manual(values  = color)+scale_color_manual(values = color)+theme_bw()+
data_stat
#each sample plot
ggplot(data5)+
#分組圖
data_stat<-merge(data5,group,by = "Sample",all.x = T)%>%
group_by(Phyla,Location)%>%
summarize(avg=mean(abundance),std=sd(abundance))%>%
ggplot()+geom_bar(aes(x=Location,y=avg,fill=Family,color=Family,alpha=0.8,stat="identity"))+scale_fill_manual(values  = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
,alpha=0.85
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
View(data)
View(group)
View(data5)
data3$Family<-factor(data3$Family,levels=c("Bacillaceae","Clostridiaceae","Comamondaceae","Micromonosporaceae","Moraxellaceae","Mycobacteriaceae","Nitrobacteraceae","Nocardioidaceae","Rhodobacteraceae","Rhodobacteraceae","Sphingomonadaceae","Xanthobacteraceae","Others"))
data4<-gather(data =data3, key ="Sample",value = "abundance",1:15)
data5<-data4[-which(data4$abundance==0),]
Sample<-colnames(data2)
Location<-c("Raw","Raw","Raw","Finished","Finished","Finished","Upstream","Upstream","Upstream","Midstream","Midstream","Midstream","Downstream","Downstream","Downstream")
group<-data.frame(cbind(Sample,Location))
group$Location<-factor(group$Location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
#分組圖
data_stat<-merge(data5,group,by = "Sample",all.x = T)%>%
group_by(Phyla,Location)%>%
summarize(avg=mean(abundance),std=sd(abundance))%>%
ggplot()+geom_bar(aes(x=Location,y=avg,fill=Family,color=Family,alpha=0.8,stat="identity"))+scale_fill_manual(values  = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
color<-c("#8DD3C7","#FFFFB3","#BEBADA","#80B1D3","#FB8072")
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data$Family<-gsub(pattern = "f__",replacement = "",x=data$Family)
rownames(data)<-data$Family
data$Family<-NULL
data[data<0.05]<-0
data_sum<-apply(data,2,sum)
dd<-1-data_sum
data2<-rbind(data,dd)
rownames(data2)[nrow(data2)]<-"Others"
data3<-data2[apply(data2, 1, function(x) !all(x==0)),]
data3$Family<-rownames(data3)
#data3$phyla<-factor(data3$phyla,levels = c("Actinobacteria","Firmicutes","Planctomycetota","Proteobacteria","Others"))
rownames(data3)<-NULL
data3$Family<-factor(data3$Family,levels=c("Bacillaceae","Clostridiaceae","Comamondaceae","Micromonosporaceae","Moraxellaceae","Mycobacteriaceae","Nitrobacteraceae","Nocardioidaceae","Rhodobacteraceae","Rhodobacteraceae","Sphingomonadaceae","Xanthobacteraceae","Others"))
data3$Family<-factor(data3$Family,levels=c("Bacillaceae","Clostridiaceae","Comamondaceae","Micromonosporaceae","Moraxellaceae","Mycobacteriaceae","Nitrobacteraceae","Nocardioidaceae","Rhodobacteraceae","Sphingomonadaceae","Xanthobacteraceae","Others"))
data4<-gather(data =data3, key ="Sample",value = "abundance",1:15)
data5<-data4[-which(data4$abundance==0),]
Sample<-colnames(data2)
Location<-c("Raw","Raw","Raw","Finished","Finished","Finished","Upstream","Upstream","Upstream","Midstream","Midstream","Midstream","Downstream","Downstream","Downstream")
group<-data.frame(cbind(Sample,Location))
group$Location<-factor(group$Location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
#分組圖
data_stat<-merge(data5,group,by = "Sample",all.x = T)%>%
group_by(Phyla,Location)%>%
summarize(avg=mean(abundance),std=sd(abundance))%>%
ggplot()+geom_bar(aes(x=Location,y=avg,fill=Family,color=Family,alpha=0.8,stat="identity"))+scale_fill_manual(values  = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data$Family<-gsub(pattern = "f__",replacement = "",x=data$Family)
rownames(data)<-data$Family
data$Family<-NULL
data[data<0.05]<-0
data_sum<-apply(data,2,sum)
dd<-1-data_sum
View(data5)
View(data_stat)
View(data_stat)
View(data2)
View(data_stat)
View(data)
data2<-rbind(data,dd)
rownames(data2)[nrow(data2)]<-"Others"
data3<-data2[apply(data2, 1, function(x) !all(x==0)),]
data3$Family<-rownames(data3)
#data3$phyla<-factor(data3$phyla,levels = c("Actinobacteria","Firmicutes","Planctomycetota","Proteobacteria","Others"))
rownames(data3)<-NULL
data3$Family<-factor(data3$Family,levels=c("Bacillaceae","Clostridiaceae","Comamondaceae","Micromonosporaceae","Moraxellaceae","Mycobacteriaceae","Nitrobacteraceae","Nocardioidaceae","Rhodobacteraceae","Sphingomonadaceae","Xanthobacteraceae","Others"))
View(data2)
data3$Family<-factor(data3$Family,levels=c("Bacillaceae","Clostridiaceae","Comamonadaceae","Micromonosporaceae","Moraxellaceae","Mycobacteriaceae","Nitrobacteraceae","Nocardioidaceae","Rhodobacteraceae","Sphingomonadaceae","Xanthobacteraceae","Others"))
data4<-gather(data =data3, key ="Sample",value = "abundance",1:15)
data5<-data4[-which(data4$abundance==0),]
Sample<-colnames(data2)
Location<-c("Raw","Raw","Raw","Finished","Finished","Finished","Upstream","Upstream","Upstream","Midstream","Midstream","Midstream","Downstream","Downstream","Downstream")
group<-data.frame(cbind(Sample,Location))
group$Location<-factor(group$Location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
#分組圖
data_stat<-merge(data5,group,by = "Sample",all.x = T)%>%
group_by(Phyla,Location)%>%
summarize(avg=mean(abundance),std=sd(abundance))%>%
ggplot()+geom_bar(aes(x=Location,y=avg,fill=Family,color=Family,alpha=0.8,stat="identity"))+scale_fill_manual(values  = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
color<-c("#8DD3C7","#FFFFB3","#BEBADA","#80B1D3","#FB8072")
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/family_rel_table.xlsx",sheet=1)
data<-data[,-(1:4)]
data<-data[,-(2:3)]
data$Family<-gsub(pattern = "f__",replacement = "",x=data$Family)
rownames(data)<-data$Family
data$Family<-NULL
data[data<0.05]<-0
data_sum<-apply(data,2,sum)
dd<-1-data_sum
data2<-rbind(data,dd)
rownames(data2)[nrow(data2)]<-"Others"
data3<-data2[apply(data2, 1, function(x) !all(x==0)),]
data3$Family<-rownames(data3)
#data3$phyla<-factor(data3$phyla,levels = c("Actinobacteria","Firmicutes","Planctomycetota","Proteobacteria","Others"))
rownames(data3)<-NULL
data3$Family<-factor(data3$Family,levels=c("Bacillaceae","Clostridiaceae","Comamonadaceae","Micromonosporaceae","Moraxellaceae","Mycobacteriaceae","Nitrobacteraceae","Nocardioidaceae","Rhodobacteraceae","Sphingomonadaceae","Xanthobacteraceae","Others"))
data4<-gather(data =data3, key ="Sample",value = "abundance",1:15)
data5<-data4[-which(data4$abundance==0),]
Sample<-colnames(data2)
Location<-c("Raw","Raw","Raw","Finished","Finished","Finished","Upstream","Upstream","Upstream","Midstream","Midstream","Midstream","Downstream","Downstream","Downstream")
group<-data.frame(cbind(Sample,Location))
group$Location<-factor(group$Location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
#分組圖
data_stat<-merge(data5,group,by = "Sample",all.x = T)%>%
group_by(Phyla,Location)%>%
summarize(avg=mean(abundance),std=sd(abundance))%>%
ggplot()+geom_bar(aes(x=Location,y=avg,fill=Family,color=Family,alpha=0.8,stat="identity"))+scale_fill_manual(values  = color)+scale_color_manual(values = color)+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
data_stat
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=10),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=9.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=9.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12))
#each sample plot
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Family,color=Family),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme_bw()+
labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),axis.text  = element_text(size=9),legend.title= element_text(size=12.5),legend.text = element_text(size=12))
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/MGE/plot/MGEblastoutform.xlsx",sheet=1,rowNames=T,colNames =T)
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/MGE/plot/MGEblastoutform.xlsx",sheet=1,rowNames=T,colNames =T)
View(data)
View(data)
data$sum<-apply(data,1,sum)
data<-data%>%
arrange(desc(sum))
data$sum<-NULL
data_other<-data[-(1:11),]
others<-apply(data_other,2,sum)
View(data_other)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/MGE/plot/MGEblastoutform.xlsx",sheet=1,rowNames=T,colNames =T)
data<-as.data.frame(t(data))
data$sum<-apply(data,1,sum)
data<-data%>%
arrange(desc(sum))
data$sum<-NULL
data_other<-data[-(1:11),]
View(data_other)
View(data)
others<-apply(data_other,2,sum)
data<-data[(1:11),]
data<-rbind(data,others)
rownames(data)[nrow(data)]<-"others"
data$`ARGs type`<-rownames(data)
View(data)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/MGE/plot/MGEblastoutform.xlsx",sheet=1,rowNames=T,colNames =T)
data<-as.data.frame(t(data))
View(data)
data$sum<-apply(data,1,sum)
data<-data%>%
arrange(desc(sum))
data$sum<-NULL
data_other<-data[-(1:11),]
others<-apply(data_other,2,sum)
data<-data[(1:11),]
data<-rbind(data,others)
rownames(data)[nrow(data)]<-"others"
data$`ARGs type`<-rownames(data)
View(data)
data<-separate(data,`ARGs type`,into = c("type","subtype"),sep = "__")
View(data)
View(data_other)
View(data)
View(data)
data[12,17]<-"Others"
View(data)
View(data)
View(data)
View(data)
View(data)
View(data)
View(data)
View(data_other)
View(data)
View(data)
View(data)
View(data)
View(data)
View(data)
data$subtype<-factor(data$subtype,levels = c("tnpA","tnpA1","tnpA13","tnpA2","tnpA3","tniA","tniB","intl1","IS26","IS91","IS1166","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype<),stat="identity",alpha=0.9)+
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
View(data_other)
View(data_other)
View(data)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/MGE/plot/MGEblastoutform.xlsx",sheet=1,rowNames=T,colNames =T)
data<-as.data.frame(t(data))
data$sum<-apply(data,1,sum)
data<-data%>%
arrange(desc(sum))
data$sum<-NULL
data_other<-data[-(1:11),]
others<-apply(data_other,2,sum)
data<-data[(1:11),]
data<-rbind(data,others)
rownames(data)[nrow(data)]<-"others"
data$`ARGs type`<-rownames(data)
data<-separate(data,`ARGs type`,into = c("type","subtype"),sep = "__")
data[12,17]<-"Others"
data$subtype<-factor(data$subtype,levels = c("tnpA","tnpA1","tnpA13","tnpA2","tnpA3","tniA","tniB","intI1","IS91","IS26","IS1166","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
RColorBrewer::display.brewer.all()
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c("#FFFFB3","8DD3C7","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F","#FB8072","#BEBADA","#80B1D3","#FDB462","#B3DE69","#8DD3C7")
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
data$subtype<-factor(data$subtype,levels = c("intl1","IS26","IS91","IS1166","tnpA","tnpA1","tnpA13","tnpA2","tnpA3","tniA","tniB","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
RColorBrewer::display.brewer.all()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
data$subtype<-factor(data$subtype,levels = c("intI1","IS26","IS91","IS1166","tnpA","tnpA1","tnpA13","tnpA2","tnpA3","tniA","tniB","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/MGE/plot/MGEblastoutform.xlsx",sheet=1,rowNames=T,colNames =T)
data<-as.data.frame(t(data))
data$sum<-apply(data,1,sum)
data<-data%>%
arrange(desc(sum))
data$sum<-NULL
data_other<-data[-(1:11),]
others<-apply(data_other,2,sum)
data<-data[(1:11),]
data<-rbind(data,others)
rownames(data)[nrow(data)]<-"others"
data$`ARGs type`<-rownames(data)
data<-separate(data,`ARGs type`,into = c("type","subtype"),sep = "__")
data[12,17]<-"Others"
data$subtype<-factor(data$subtype,levels = c("intI1","IS26","IS91","IS1166","tnpA","tnpA1","tnpA13","tnpA2","tnpA3","tniA","tniB","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
color<-c("#FFFFB3","8DD3C7","#FCCDE5","#D9D9D9","#BC80BD","#CCEBC5","#FFED6F","#FB8072","#BEBADA","#80B1D3","#FDB462","#B3DE69","#8DD3C7")
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
data$subtype<-factor(data$subtype,levels = c("IS26","IS91","IS1166","intI1","tnpA","tnpA1","tnpA13","tnpA2","tnpA3","tniA","tniB","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
brewer.pal(n=12,name="Set3")
display.brewer.pal(n=12,name="Set3")
data$subtype<-factor(data$subtype,levels = c("intI1","IS26","IS91","IS1166","tnpA","tnpA1","tnpA13","tnpA2","tnpA3","tniA","tniB","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
scale_fill_manual(color=color)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()+
guides(fill=guide_legend(title="MGEs"))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=subtype,color=subtype),stat="identity",alpha=0.9)+
scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization aganist 16S")+theme_bw()+
guides(fill=guide_legend(title="MGEs"),color=guide_legend(title="MGEs"))
