library(gridExtra)
library("tidyverse")
library("openxlsx")
library("stringr")
library("RColorBrewer")
#for safety reason we need to assign google api key each time
register_googlye(key = "AIzaSyByVs5h-0bXkzfnERL-43zp19spE7LtEoM")
#for safety reason we need to assign google api key each time
register_google(key = "AIzaSyByVs5h-0bXkzfnERL-43zp19spE7LtEoM")
trek_df <- trek("23.125018652096625, 121.39324881712558", "22.875292748459103, 121.22908696386816", structure = "route")
TaitoungMap <- get_googlemap(
center  = c(lon=121.31154590744264,lat=22.998088043256093),
zoom = 11, maptype = 'roadmap')
#draw a plot
display.brewer.pal(name="Spectral",n=11)
brewer.pal(name="Spectral",n=11)
cols=c("#66C2A5","#3288BD")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
sample<-read.xlsx(xlsxFile = "C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/Plot/採樣位置/採樣點地理資訊.xlsx",sheet=3)
trek_df <- trek("23.125018652096625, 121.39324881712558", "22.875292748459103, 121.22908696386816", structure = "route")
#for safety reason we need to assign google api key each time
register_google(key = "AIzaSyByVs5h-0bXkzfnERL-43zp19spE7LtEoM")
TaitoungMap <- get_googlemap(
center  = c(lon=121.31154590744264,lat=22.998088043256093),
zoom = 11, maptype = 'roadmap')
#draw a plot
display.brewer.pal(name="Spectral",n=11)
brewer.pal(name="Spectral",n=11)
cols=c("#66C2A5","#3288BD")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
brewer.pal(name="Sunset",n=12)
brewer.pal(name="Set3",n=12)
cols=c("#BEBADA" , "#80B1D3","#FFFFB3")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(value=cols)
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
#draw a plot
display.brewer.pal(name="Spectral",n=11)
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
library(scales)
hex <- hue_pal()(2)
show_col(hex)
hex
hex <- hue_pal()(5)
show_col(hex)
hex <- hue_pal()(10)
show_col(hex)
hex <- hue_pal()(15)
hex <- hue_pal()(15)
show_col(hex)
hex <- hue_pal()(3)
show_col(hex)
brewer.pal(name="Spectral",n=11)
cols=c("#F8766D","#5E4FA2","#00BFC4")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
cols=c("#5E4FA2","#F8766D","#00BFC4")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
cols=c("#FEE08B" ,"#F8766D","#00BFC4")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
cols=c("#3288BD" ,"#F8766D","#00BFC4")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
cols=c("#3288BD" ,"#F8766D","#00BFC4")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
library(ggmap)
library(ggplot2)
library(dplyr)
library(gridExtra)
library("tidyverse")
library("openxlsx")
library("stringr")
library("RColorBrewer")
sample<-read.xlsx(xlsxFile = "C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/Plot/採樣位置/採樣點地理資訊.xlsx",sheet=3)
trek_df <- trek("23.125018652096625, 121.39324881712558", "22.875292748459103, 121.22908696386816", structure = "route")
#for safety reason we need to assign google api key each time
register_google(key = "AIzaSyByVs5h-0bXkzfnERL-43zp19spE7LtEoM")
trek_df <- trek("23.125018652096625, 121.39324881712558", "22.875292748459103, 121.22908696386816", structure = "route")
TaitoungMap <- get_googlemap(
center  = c(lon=121.31154590744264,lat=22.998088043256093),
zoom = 11, maptype = 'roadmap')
cols=c("#3288BD" ,"#F8766D","#00BFC4")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+theme_bw()#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=4.5)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=5,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.2)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.8,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.5)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.3)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
library(scales)
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
,family="serif"
,family="serif"
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
sample<-read.xlsx(xlsxFile = "C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/Plot/採樣位置/採樣點地理資訊.xlsx",sheet=4)
trek_df <- trek("23.125018652096625, 121.39324881712558", "22.875292748459103, 121.22908696386816", structure = "route")
#for safety reason we need to assign google api key each time
register_google(key = "AIzaSyByVs5h-0bXkzfnERL-43zp19spE7LtEoM")
TaitoungMap <- get_googlemap(
center  = c(lon=121.31154590744264,lat=22.998088043256093),
zoom = 11, maptype = 'roadmap')
cols=c("#3288BD" ,"#F8766D","#00BFC4")
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")#scale_color_manual(values=cols)
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
shape=c(15,16,17)
TaitoungMappoint<- ggmap(TaitoungMap)+
geom_point(data=sample,aes(x=lon, y=lat,shape=type,color=type),size=3)+geom_text(data=sample,label=sample$sampeltype,family="serif",size=6,vjust =1.6,hjust=-0.1)+theme_minimal()+theme (legend.position= "none")+scale_color_manual(values=cols)+scale_shape_manual(values = shape)
#+geom_path(aes(x = lon, y = lat),  colour = "#66a182",size = 2.3, alpha = .7,data = trek_df, lineend = "square")
TaitoungMappoint
source("~/GitHub/R_scripts/Plot/amplicon sequencing pcoa.R", echo=TRUE)
View(dbpata)
View(dbpata)
View(dbpata1)
source("~/GitHub/R_scripts/Plot/amplicon sequencing pcoa.R", echo=TRUE)
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
library(ggplot2)
library(ggplot2)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
#data1<-data1[-(1:3),]
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
precentage<-data_core_sum/data_sum
data1$precentage<-precentage
summary(lm(total_arg ~ core_arg, data=data1))
cor.test(data1$core_arg,data1$total_arg,method="pearson")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#80B1D3")
data_core_percentenge<-(data_core_sum/data_sum)
data_other<-1-(data_core_percentenge)
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_percentenge,`Other ARGs`=data_other)))
plotdata$sample<-rownames(plotdata)
plotdata<-gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.8,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
source("~/GitHub/R_scripts/Plot/core_ARG ARG correlation.R", echo=TRUE)
cor.test(data1$core_arg,data1$total_arg,method="pearson")
View(data_core)
View(data_core)
View(data_core)
View(data_core)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
data_core[,-16]%>%
column_to_rownames(`data_core$ARGs.abundance.normalization.aganist.16S`)
ata_core[,-16]
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
filter(1:16)%>%
column_to_rownames(`data_core$ARGs.abundance.normalization.aganist.16S`)
View(data_core)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
filter(,1:16)%>%
column_to_rownames(`data_core$ARGs.abundance.normalization.aganist.16S`)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames(`data_core$ARGs.abundance.normalization.aganist.16S`)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames(`data_core$ARGs.abundance.normalization.aganist.16S`)
data_core1<-data_core%>%
select(1:16)
View(data_core1)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames(`ARGs.abundance.normalization.aganist.16S`)
data_core
View(data_core)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames(data_core$ARGs.abundance.normalization.aganist.16S)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames(ARGs.abundance.normalization.aganist.16S)
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames(`ARGs.abundance.normalization.aganist.16S`)
View(data_core1)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
rbind(.,data_sum)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
rbind(datasum=data_sum)
View(data_core1)
##each core ARG corr with total ARGs-----------
data_core1<-data_core1[,1:16]
##each core ARG corr with total ARGs-----------
data_core1<-data_core[,1:16]
data_sum<-c("data_sum",data_sum)
##each core ARG corr with total ARGs-----------
data_core1<-data_core[,1:16]
View(data_core)
data_core1<-data_core[,1:16]%>%
column_to_rownames("ARGs.abundance.normalization.aganist.16S")
View(data_core1)
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames("ARGs.abundance.normalization.aganist.16S")%>%
rbind(,data_sum)%>%
as.data.frame()
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames("ARGs.abundance.normalization.aganist.16S")%>%
rbind(.,data_sum)%>%
as.data.frame()
View(data_core1)
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames("ARGs.abundance.normalization.aganist.16S")
data_core1<-rbind(data_core1,data_sum)
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
library(ggplot2)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
#data1<-data1[-(1:3),]
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
precentage<-data_core_sum/data_sum
data1$precentage<-precentage
summary(lm(total_arg ~ core_arg, data=data1))
cor.test(data1$core_arg,data1$total_arg,method="pearson")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#80B1D3")
data_core_percentenge<-(data_core_sum/data_sum)
data_other<-1-(data_core_percentenge)
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_percentenge,`Other ARGs`=data_other)))
plotdata$sample<-rownames(plotdata)
plotdata<-gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.8,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames("ARGs.abundance.normalization.aganist.16S")
data_core1<-rbind(data_core1,data_sum)
View(data_core1)
data_core1<-rbind(data_core1,ARG_sum=data_sum)
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
library(ggplot2)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
#data1<-data1[-(1:3),]
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
precentage<-data_core_sum/data_sum
data1$precentage<-precentage
summary(lm(total_arg ~ core_arg, data=data1))
cor.test(data1$core_arg,data1$total_arg,method="pearson")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#80B1D3")
data_core_percentenge<-(data_core_sum/data_sum)
data_other<-1-(data_core_percentenge)
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_percentenge,`Other ARGs`=data_other)))
plotdata$sample<-rownames(plotdata)
plotdata<-gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.8,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames("ARGs.abundance.normalization.aganist.16S")
data_core1<-rbind(data_core1,ARG_sum=data_sum)
View(data_core1)
data_core1<-rbind(data_core1,ARG_sum=data_sum)%>%
t()%>%
as.data.frame()
View(data_core1)
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
library(ggplot2)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
#data1<-data1[-(1:3),]
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
precentage<-data_core_sum/data_sum
data1$precentage<-precentage
summary(lm(total_arg ~ core_arg, data=data1))
cor.test(data1$core_arg,data1$total_arg,method="pearson")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#80B1D3")
data_core_percentenge<-(data_core_sum/data_sum)
data_other<-1-(data_core_percentenge)
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_percentenge,`Other ARGs`=data_other)))
plotdata$sample<-rownames(plotdata)
plotdata<-gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.8,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
##each core ARG corr with total ARGs-----------
data_core1<-data_core%>%
select(1:16)%>%
column_to_rownames("ARGs.abundance.normalization.aganist.16S")
data_core1<-rbind(data_core1,ARG_sum=data_sum)%>%
t()%>%
as.data.frame()
library(Hmisc)
#corrtest
data<-data_core1
library(Hmisc)
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'pearson')
#corr<-as.list(corrx)
corr$P[corr$P >= 0.05] <- -1
corr$P[corr$P < 0.05 & corr$P >= 0] <- 1
corr$P[corr$P == -1] <- 0
#我們先輸出一次有顯著相關但相關性未必足夠的矩陣
corr_significiant<-corr$r * corr$P
#因為write.xlsx之output要是dataframe
corr_significiant.dataframe<-as.data.frame(corr_significiant)
write.xlsx(corr_significiant.dataframe, 'C:/Users/USER/Desktop/小型testp0.05.xlsx',rowNames=T,colNames=T,keepNA=T)
#corrtest
data<-data_core1
data<-data[-(1:6),]
library(Hmisc)
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'pearson')
#corr<-as.list(corrx)
corr$P[corr$P >= 0.05] <- -1
corr$P[corr$P < 0.05 & corr$P >= 0] <- 1
corr$P[corr$P == -1] <- 0
#我們先輸出一次有顯著相關但相關性未必足夠的矩陣
corr_significiant<-corr$r * corr$P
#因為write.xlsx之output要是dataframe
corr_significiant.dataframe<-as.data.frame(corr_significiant)
write.xlsx(corr_significiant.dataframe, 'C:/Users/USER/Desktop/小型testp0.05.xlsx',rowNames=T,colNames=T,keepNA=T)
#接著將計算出來之相關性大於0.8且p小於0.05者留下
corr$r[corr$r < 0.8] <- 0
data<-data_core1
data<-data[-(1:6),]
library(Hmisc)
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'pearson')
corr$r
corr$r
corr$r[["ARG_sum"]]
corr$[["ARG_sum"]
corr$["ARG_sum"]
corr$r["ARG_sum"]
corr$r[26]
View(corr)
corr[["r"]]
cor[["r"]]
corr[["r"]]
corr[["r"]][27,]
cbind(r=corr[["r"]][27,],p=corr[["P"]][27,])
data2<-cbind(r=corr[["r"]][27,],p=corr[["P"]][27,])
View(data2)
#corrtest
data<-data_core1
library(Hmisc)
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'pearson')
data2<-cbind(r=corr[["r"]][27,],p=corr[["P"]][27,])
#corrtest
data<-data_core1
data<-data[-(1:3),]
library(Hmisc)
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'pearson')
data2<-cbind(r=corr[["r"]][27,],p=corr[["P"]][27,])
data<-data[-(1:6),]
library(Hmisc)
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'pearson')
data2<-cbind(r=corr[["r"]][27,],p=corr[["P"]][27,])
write.xlsx(data2, 'C:/Users/USER/Desktop/小型test.xlsx',rowNames=T,colNames=T)
data<-data_core1
data<-data[-(1:6),]
library(Hmisc)
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'pearson')
data2<-cbind(r=corr[["r"]][27,],p=corr[["P"]][27,])
write.xlsx(data2, 'C:/Users/USER/Desktop/小型test.xlsx',rowNames=F,colNames=T)
data2<-as.data.frame(cbind(r=corr[["r"]][27,],p=corr[["P"]][27,]))
write.xlsx(data2, 'C:/Users/USER/Desktop/小型test.xlsx',rowNames=F,colNames=T)
write.xlsx(data2, 'C:/Users/USER/Desktop/小型test.xlsx',rowNames=T,colNames=T)
