print(p)
library(vegan)
library(ecodist)
library(ggplot2)
library(openxlsx)
library(RColorBrewer)
library(scatterplot3d)
library(pairwiseAdonis)
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames=T,sep.names=" ")
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames=T,sep.names=" ")
groupata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/groupdata.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
dbpata <-as.data.frame(t(dbpata))
View(dbpata)
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
groupata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/groupdata.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
#因為species太多了，我們把小於0.01%的species清掉
#dbpata[dbpata<0.0001]<-0
dbpata<-dbpata[apply(dbpata, 1, function(x) !all(x==0)),]
dbpata <-as.data.frame(t(dbpata))
#Hellinger不一定需要，ARG不用
dbpata <- decostand(dbpata, method = 'hellinger')
family_bray<-vegdist(dbpata, method="bray")
length_1<-length(rownames(dbpata))
pcoa = cmdscale(family_bray, k=(length_1-1), eig=TRUE)
points=scores(pcoa)
eig = pcoa$eig
eig
points<-as.data.frame(points)
points <-cbind(points, groupata[match(rownames(points), rownames(groupata)), ])
#用Adonis 來檢定組間差異是不是顯著的
x<-adonis2(dbpata~location,data = groupata)
x
dbpata_adonis <- paste0("adonis R2: ",round(x$R2,2), "; P-value: ", x$`Pr(>F)`)
#檢驗adnois，我們需要檢驗一下這個adonis的結果是不是因為分組數據的離散程度不同造成的
dbpata.dis <- vegdist(dbpata, method="bray", binary=F)
dispersion <- betadisper(dbpata.dis, group=groupata$location)
permutest(dispersion,permutations = 99999)
#準備畫圖
points$location<-factor(points$location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
RColorBrewer::display.brewer.all()
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c("#FB8072","#BEBADA","#80B1D3","#FDB462","#B3DE69")
#2dpcoa
ggplot(points, aes(x=Dim1, y=Dim2,colour=location))+
theme_bw()+
geom_point(size=3,alpha=0.7)+#geom_text(aes(label=sample_ID),size=3,color="black",)+
scale_color_manual(values = color)+geom_vline(xintercept = 0, color = 'gray', linetype = 2) +
geom_hline(yintercept = 0, color = 'gray', linetype = 2,) +
labs(x=paste("PCoA 1 (", format(100 * eig[1] / sum(eig), digits=4), "%)", sep=""),
y=paste("PCoA 2 (", format(100 * eig[2] / sum(eig), digits=4), "%)", sep=""),
title="Bray_curtis PCoA")+theme(axis.title = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))+scale_color_manual("Location",values =color)
#3dpoca
colors=color[as.numeric(points$location)]
#3dpoca
colors=color[as.numeric(points$location)]
colnames(points)[1]<-paste("PCoA 1 (", format(100 * eig[1] / sum(eig), digits=4), "%)", sep="")
colnames(points)[2]<-paste("PCoA 2 (", format(100 * eig[2] / sum(eig), digits=4), "%)", sep="")
colnames(points)[3]<-paste("PCoA 3 (", format(100 * eig[3] / sum(eig), digits=4), "%)", sep="")
scatterplot3d(points[,1:3],color=colors,main="Bray_curtis PCoA",pch=16,cex.symbols = 1.3)
legend("bottom",col=color,legend=levels(points$location),pt.bg = colors,pch=16,inset=-0.17,xpd =T,horiz = T)
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
groupata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/groupdata.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
groupata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/groupdata.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
#因為species太多了，我們把小於0.01%的species清掉
#dbpata[dbpata<0.0001]<-0
dbpata<-dbpata[apply(dbpata, 1, function(x) !all(x==0)),]
#Hellinger不一定需要，ARG不用
dbpata <- decostand(dbpata, method = 'hellinger')
family_bray<-vegdist(dbpata, method="bray")
length_1<-length(rownames(dbpata))
pcoa = cmdscale(family_bray, k=(length_1-1), eig=TRUE)
points=scores(pcoa)
eig = pcoa$eig
eig
points<-as.data.frame(points)
points <-cbind(points, groupata[match(rownames(points), rownames(groupata)), ])
#用Adonis 來檢定組間差異是不是顯著的
x<-adonis2(dbpata~location,data = groupata)
dbpata_adonis <- paste0("adonis R2: ",round(x$R2,2), "; P-value: ", x$`Pr(>F)`)
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
groupata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/groupdata.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
#因為species太多了，我們把小於0.01%的species清掉
#dbpata[dbpata<0.0001]<-0
dbpata<-dbpata[apply(dbpata, 1, function(x) !all(x==0)),]
#Hellinger不一定需要，ARG不用
dbpata <- decostand(dbpata, method = 'hellinger')
family_bray<-vegdist(dbpata, method="bray")
length_1<-length(rownames(dbpata))
pcoa = cmdscale(family_bray, k=(length_1-1), eig=TRUE)
points=scores(pcoa)
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
groupata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/groupdata.xlsx",sheet=1,rowNames=T,colNames=T,sep.names=" ")
#因為species太多了，我們把小於0.01%的species清掉
#dbpata[dbpata<0.0001]<-0
dbpata<-dbpata[apply(dbpata, 1, function(x) !all(x==0)),]
dbpata <-as.data.frame(t(dbpata))
#Hellinger不一定需要，ARG不用
dbpata <- decostand(dbpata, method = 'hellinger')
family_bray<-vegdist(dbpata, method="bray")
length_1<-length(rownames(dbpata))
pcoa = cmdscale(family_bray, k=(length_1-1), eig=TRUE)
points=scores(pcoa)
eig = pcoa$eig
eig
points<-as.data.frame(points)
points <-cbind(points, groupata[match(rownames(points), rownames(groupata)), ])
#用Adonis 來檢定組間差異是不是顯著的
x<-adonis2(dbpata~location,data = groupata)
x
dbpata_adonis <- paste0("adonis R2: ",round(x$R2,2), "; P-value: ", x$`Pr(>F)`)
#檢驗adnois，我們需要檢驗一下這個adonis的結果是不是因為分組數據的離散程度不同造成的
dbpata.dis <- vegdist(dbpata, method="bray", binary=F)
dispersion <- betadisper(dbpata.dis, group=groupata$location)
permutest(dispersion,permutations = 99999)
#準備畫圖
points$location<-factor(points$location,levels=c('Raw', 'Finished', 'Upstream','Midstream','Downstream'))
RColorBrewer::display.brewer.all()
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c("#FB8072","#BEBADA","#80B1D3","#FDB462","#B3DE69")
#2dpcoa
ggplot(points, aes(x=Dim1, y=Dim2,colour=location))+
theme_bw()+
geom_point(size=3,alpha=0.7)+#geom_text(aes(label=sample_ID),size=3,color="black",)+
scale_color_manual(values = color)+geom_vline(xintercept = 0, color = 'gray', linetype = 2) +
geom_hline(yintercept = 0, color = 'gray', linetype = 2,) +
labs(x=paste("PCoA 1 (", format(100 * eig[1] / sum(eig), digits=4), "%)", sep=""),
y=paste("PCoA 2 (", format(100 * eig[2] / sum(eig), digits=4), "%)", sep=""),
title="Bray_curtis PCoA")+theme(axis.title = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))+scale_color_manual("Location",values =color)
data_contig<-read.xlsx("C:/Users/USER/Desktop/ARC_analysis_phyla_plasflow.xlsx",sheet=1)
library(openxlsx)
library(tidyverse)
data_contig<-read.xlsx("C:/Users/USER/Desktop/ARC_analysis_phyla_plasflow.xlsx",sheet=1)
View(data_contig)
data_contig$contig_phyla[is.na(data_contig$contig_phyla)]<-"Unclassified"
data_contig$contig_phyla[data_contig$contig_phyla == "Bacteria"]<-"Unclassified"
View(data_contig)
View(data_contig)
data_stat<-data_contig%>%
group_by(type.x,plas_type) %>%
mutate(count())%>%
summarise_at(vars(n), funs(sum))
data_stat<-data_contig%>%
group_by(type.x,plas_type) %>%
mutate(count())
data_stat<-data_contig%>%
group_by(type.x,plas_type) %>%
mutate(n=count())
data_stat<-data_contig%>%
group_by(type.x,plas_type) %>%
count()
View(data_contig)
View(data_stat)
View(data_stat)
data_stat_percentage<-data_stat%>%
group_by(type.x)%>%
mutate(sum=sum(n))
View(data_stat_percentage)
View(data_stat_percentage)
data_stat_percentage<-data_stat%>%
group_by(type.x)%>%
mutate(percent=n/sum(n))
View(data_stat_percentage)
View(data_stat_percentage)
View(data_stat_percentage)
View(data_stat_percentage)
data_stat_percentage<-data_stat%>%
group_by(type.x)%>%
mutate(percent=n/sum(n))%>%
ggplot()+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")
data_stat
data_stat_percentage<-data_stat%>%
group_by(type.x)%>%
mutate(percent=n/sum(n))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")
data_stat_percentage<-data_stat%>%
group_by(type.x)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
View(data_stat_percentage)
View(data_stat_percentage)
data_stat_percentage$type.x[data_stat_percentage$type.x=="macrolide-lincosamide-streptogramin"]<-"MLS"
data_stat_percentage$type.x<-str_to_sentence(data_stat_percentage$type.x)
View(data_stat_percentage)
data_stat_percentage<-data_stat%>%
group_by(type.x)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
data_stat_percentage$type.x<-str_to_sentence(data_stat_percentage$type.x)
data_stat_percentage$type.x[data_stat_percentage$type.x=="Macrolide-lincosamide-streptogramin"]<-"MLS"
View(data_stat_percentage)
color<-c( "#FFFFB3" ,"#BC80BD" ,,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
color<-c( "#FFFFB3" ,"#BC80BD" ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
color<-c( "#FFFFB3" ,"#BEBADA"  ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual("location",values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual("location",values = color)+scale_color_manual("location",values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+
theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity")+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity",width=0.6)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
data_stat_percentage$plas_type<-str_to_sentence(data_stat_percentage$plas_type)
color<-c( "#FFFFB3" ,"#BEBADA"  ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.85,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12.5),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
##draw ARG type plasflow output
data_stat_percentage<-data_stat%>%
group_by(type.x)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
data_stat_percentage$type.x<-str_to_sentence(data_stat_percentage$type.x)
data_stat_percentage$type.x[data_stat_percentage$type.x=="Macrolide-lincosamide-streptogramin"]<-"MLS"
data_stat_percentage$plas_type<-str_to_sentence(data_stat_percentage$plas_type)
color<-c( "#FFFFB3" ,"#BEBADA"  ,"#80B1D3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
data_stat
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),position="dodge",stat="identity",alpha=0.7)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),stat="identity",alpha=0.7)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),stat="identity",alpha=0.7)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARCs number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARCs number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
color<-c( "#BEBADA"  ,"#80B1D3","#FFFFB3" , ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
#relative abundance
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
color<-c( "#BEBADA"  ,"#80B1D3","#FFFFB3" ,,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
#relative abundance
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
color<-c( "#BEBADA"  ,"#80B1D3","#FFFFB3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
#relative abundance
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
color<-c( "#80B1D3","#BEBADA"  ,"#FFFFB3" ,"#FDB462" ,"#B3DE69" ,"#FCCDE5" ,"#D9D9D9","#BEBADA" ,"#CCEBC5" ,"#FFED6F")
#relative abundance
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),stat="identity",position="dodge",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#sum
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=n,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
##draw location plasflow output
data_contig_Sample<-read.xlsx("C:/Users/USER/Desktop/ARC_plasflow out.xlsx",sheet=2)
View(data_contig_Sample)
View(data_contig_Sample)
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL"),sep=".")
View(data_stat_percentage)
View(data_contig_Sample)
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL"),sep="\.")
##draw location plasflow output
data_contig_Sample<-read.xlsx("C:/Users/USER/Desktop/ARC_plasflow out.xlsx",sheet=2)
View(data_contig_Sample)
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL"),sep=".")
View(data_contig_Sample)
##draw location plasflow output
data_contig_Sample<-read.xlsx("C:/Users/USER/Desktop/ARC_plasflow out.xlsx",sheet=2)
View(data_contig_Sample)
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL",'ff'),sep=".")
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL"))
View(data_contig_Sample)
##draw location plasflow output
data_contig_Sample<-read.xlsx("C:/Users/USER/Desktop/ARC_plasflow out.xlsx",sheet=2)
View(data_contig_Sample)
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL"))
View(data_contig_Sample)
data_contig_Sample$id<-NULL
data_contig_Sample$NUL<-NULL
data_contig_Sample$Sample[data_contig_Sample$Sample=="T1"]<-"Raw"
View(data_contig_Sample)
data_contig_Sample$Sample[data_contig_Sample$Sample=="T1"]<-"Raw"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T1"]<-"Raw"
data_contig_Sample<-read.xlsx("C:/Users/USER/Desktop/ARC_plasflow out.xlsx",sheet=2)
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL"))
data_contig_Sample$id<-NULL
data_contig_Sample$NUL<-NULL
data_contig_Sample$Sample[data_contig_Sample$Sample=="T1"]<-"Raw"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T2"]<-"Finished"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T3"]<-"Upstream"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T4"]<-"Midstream"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T5"]<-"Downstream"
data_contig_Sample$type<-str_to_sentence(data_contig_Sample$type)
View(data_contig_Sample)
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)
View(data_contig_Sample)
View(data_contig_Sample_sta)
View(data_contig_Sample)
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)
View(data_contig_Sample_sta)
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
count()
View(data_stat)
View(data_contig_Sample_sta)
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
count()%>%
group_by(Sample)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
View(data_contig_Sample_sta)
data_contig_Sample_sta$Sample<-factor(data_contig_Sample_sta$Sample,levels = c("Raw","Finished","Upstream","Midstream","Downstream"))
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
count()%>%
group_by(Sample)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
View(data_contig_Sample)
View(data_contig_Sample_sta)
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity",width=0.8)
##draw location plasflow output
data_contig_Sample<-read.xlsx("C:/Users/USER/Desktop/ARC_plasflow out.xlsx",sheet=2)
data_contig_Sample<-data_contig_Sample%>%
separate(label,into=c("type","NUL"))
data_contig_Sample$id<-NULL
data_contig_Sample$NUL<-NULL
data_contig_Sample$Sample[data_contig_Sample$Sample=="T1"]<-"Raw"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T2"]<-"Finished"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T3"]<-"Upstream"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T4"]<-"Midstream"
data_contig_Sample$Sample[data_contig_Sample$Sample=="T5"]<-"Downstream"
data_contig_Sample$type<-str_to_sentence(data_contig_Sample$type)
data_contig_Sample_sta$Sample<-factor(data_contig_Sample_sta$Sample,levels = c("Raw","Finished","Upstream","Midstream","Downstream"))
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
count()%>%
group_by(Sample)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
count()%>%
group_by(Sample)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
data_contig_Sample_sta$Sample<-factor(data_contig_Sample_sta$Sample,levels = c("Raw","Finished","Upstream","Midstream","Downstream"))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="Location",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Gene location",values = color)+theme_bw()+labs(x="Gene location",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Gene location",values = color)+scale_color_manual("Gene location",values = color)+theme_bw()+labs(x="Location",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Gene Location",values = color)+scale_color_manual("Gene Location",values = color)+theme_bw()+labs(x="Location",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity")+
scale_fill_manual("Gene Location",values = color)+scale_color_manual("Gene Location",values = color)+theme_bw()+labs(x="Location",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
data_contig_Sample
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
filter(contig_length>=1000)%>%
count()%>%
group_by(Sample)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
data_contig_Sample_sta$Sample<-factor(data_contig_Sample_sta$Sample,levels = c("Raw","Finished","Upstream","Midstream","Downstream"))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity")+
scale_fill_manual("Gene Location",values = color)+scale_color_manual("Gene Location",values = color)+theme_bw()+labs(x="Location",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
View(data_contig_Sample)
View(data_contig_Sample_sta)
data_contig_Sample_sta<-data_contig_Sample%>%
group_by(Sample,type)%>%
count()%>%
group_by(Sample)%>%
mutate(percent=n/sum(n))%>%
mutate(sum=sum(n))
data_contig_Sample_sta$Sample<-factor(data_contig_Sample_sta$Sample,levels = c("Raw","Finished","Upstream","Midstream","Downstream"))
ggplot(data_contig_Sample_sta)+geom_bar(aes(x=Sample,y=percent,fill=type,color=type),alpha=0.7,stat="identity")+
scale_fill_manual("Gene Location",values = color)+scale_color_manual("Gene Location",values = color)+theme_bw()+labs(x="Location",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
data_contig_Sample
data_stat
View(data_contig_Sample)
View(data_contig_Sample_sta)
View(data_contig)
#coverage
data_stat_percentage<-data_contig%>%
group_by(type.x,plas_type)%>%
summarise_at(vars(contig_coverage), funs(sum))
View(data_stat_percentage)
#coverage
data_stat_cover_sum<-data_contig%>%
group_by(type.x,plas_type)%>%
summarise_at(vars(contig_coverage), funs(sum))
View(data_stat_cover_sum)
ggplot(data_stat_percentage)+geom_bar(aes(x=type.x,y=contig_coverage,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_stat_cover_sum)+geom_bar(aes(x=type.x,y=contig_coverage,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC number")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_stat_cover_sum)+geom_bar(aes(x=type.x,y=contig_coverage,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC coverage (x/GB)")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
#coverage
data_stat_cover_sum<-data_contig%>%
group_by(type.x,plas_type)%>%
summarise_at(vars(contig_coverage), funs(sum))
data_stat_cover_sum$type.x<-str_to_sentence(data_stat_cover_sum$type.x)
data_stat_cover_sum$type.x[data_stat_cover_sum$type.x=="Macrolide-lincosamide-streptogramin"]<-"MLS"
ggplot(data_stat_cover_sum)+geom_bar(aes(x=type.x,y=contig_coverage,fill=plas_type,color=plas_type),stat="identity",alpha=0.7,width = 0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="ARC coverage (x/GB)")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
View(data_stat_cover_sum)
data_stat_cover_sum<-data_contig%>%
group_by(type.x,plas_type)%>%
summarise_at(vars(contig_coverage), funs(sum))%>%
group_by(type.x)%>%
mutate(percent=contig_coverage/sum(contig_coverage))%>%
mutate(sum=sum(contig_coverage))
View(data_stat_percentage)
View(data_stat_cover_sum)
ggplot(data_stat_cover_sum)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data_stat_cover_sum)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Covereage Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
##coverage relative abundance
data_stat_cover_sum<-data_contig%>%
group_by(type.x,plas_type)%>%
summarise_at(vars(contig_coverage), funs(sum))%>%
group_by(type.x)%>%
mutate(percent=contig_coverage/sum(contig_coverage))%>%
mutate(sum=sum(contig_coverage))
data_stat_cover_sum$type.x<-str_to_sentence(data_stat_cover_sum$type.x)
data_stat_cover_sum$type.x[data_stat_cover_sum$type.x=="Macrolide-lincosamide-streptogramin"]<-"MLS"
ggplot(data_stat_cover_sum)+geom_bar(aes(x=type.x,y=percent,fill=plas_type,color=plas_type),alpha=0.7,stat="identity",width=0.8)+
scale_fill_manual("Location",values = color)+scale_color_manual("Location",values = color)+theme_bw()+labs(x="ARG Type",y="Covereage Relative abundance")+
theme(axis.title = element_text(size=13),axis.text = element_text(size=12),legend.title= element_text(size=12),legend.text = element_text(size=12))
