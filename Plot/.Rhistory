geom_bar(aes(x=Sample,y=abundance,fill=Genus,color=Genus),alpha=0.85,stat="identity")+
scale_fill_brewer(palette = "Set3")
ggplot(data5)+
geom_bar(aes(x=Sample,y=abundance,fill=Genus,color=Genus),alpha=0.85,stat="identity")
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/genus_rel_table.xlsx",sheet=1)
data<-data[,-(1:5)]
data<-data[,-(2)]
data$Genus<-gsub(pattern = "g__",replacement = "",x=data$Genus)
rownames(data)<-data$Genus
data$Genus<-NULL
data[data<0.1]<-0
data_sum<-apply(data,2,sum)
dd<-1-data_sum
data2<-rbind(data,dd)
rownames(data2)[nrow(data2)]<-"Others"
data3<-data2[apply(data2, 1, function(x) !all(x==0)),]
data3$Genus<-rownames(data3)
View(data3)
library(openxlsx)
library(tidyverse)
library(Hmisc)
library("openxlsx")
library("Hmisc")
library("tidyverse")
data_ARGsub<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,sep.names=" ")
data_taxa<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/genus_rel_table.xlsx",sheet=1,rowNames=F,sep.names=" ")
#ARGdata名稱處理
data_ARGsub<-data_ARGsub%>%
separate(`ARGs abundance normalization aganist 16S`,into=c("type","subtype"),sep="__")
rownames(data_ARGsub)<-data_ARGsub$subtype
argclass<-data_ARGsub[,1:2]
data_ARGsub$type<-NULL
data_ARGsub$subtype<-NULL
data_ARGsub<-data_ARGsub[apply(data_ARGsub, 1, function(x) !all(x==0)),]
#taxa名稱處理
data_taxa<-data_taxa%>%
separate(Genus,into=c("n","Genus"),sep = "__")
rownames(data_taxa)<-data_taxa$Genus
data_taxa<-data_taxa[,-(1:8)]
data_taxa<-data_taxa[apply(data_taxa, 1, function(x) !all(x==0)),]
#taxa top 20 abundance
data_taxa$sum<-apply(data_taxa,1,sum)
data_taxa<-arrange(data_taxa, desc(sum))
data_taxa<-data_taxa[1:100,]
data_taxa$sum<-NULL
#merge two df
data_ARGsub<-as.data.frame(t(data_ARGsub))
data_taxa<-as.data.frame(t(data_taxa))
data_ARGsub$sample<-rownames(data_ARGsub)
data_taxa$sample<-rownames(data_taxa)
data<-merge(data_taxa,data_ARGsub)
rownames(data)<-data$sample
data$sample<-NULL
#data<-as.data.frame(t(data))
#計算出現次數
data_clean<-data
#因為rcorr()他的input要是matrix
data.matrix<-as.matrix(data)
corr<-rcorr(data.matrix,type= 'spearman')
#P值修正
corr_P_adj <- p.adjust(corr$P, method = 'BH')
matrix_corr_P_adj <- matrix(corr_P_adj,nrow=(length(corr$P)**0.5))
colnames(matrix_corr_P_adj)<-colnames(corr$P)
rownames(matrix_corr_P_adj) <- rownames(corr$P)
#corr<-as.list(corrx)
corr$P[corr$P >= 0.05] <- -1
corr$P[corr$P < 0.05 & corr$P >= 0] <- 1
corr$P[corr$P == -1] <- 0
#我們先輸出一次有顯著相關但相關性未必足夠的矩陣
corr_significiant<-corr$r * corr$P
#因為write.xlsx之output要是dataframe
corr_significiant.dataframe<-as.data.frame(corr_significiant)
write.xlsx(corr_significiant.dataframe, 'C:/Users/USER/Desktop/小型testp0.05.xlsx',rowNames=T,colNames=T,keepNA=T)
#接著將計算出來之相關性大於0.8且p小於0.05者留下
corr$r[corr$r < 0.8] <- 0
corr_final <-corr$r * corr$P
#因為計算相關性只會有半邊的矩陣(上面是多餘的)所以我們只會需要下三角矩陣，且不需要對角矩陣(都為1)
corr_final[!lower.tri(corr_final)] <- 0
#有些數據因為是0所以算不出相關性(na)，我們把她去除
corr_final[is.na(corr_final)]<-0
corr_final.dataframe<-as.data.frame(corr_final)
corr_final.dataframe<-corr_final.dataframe[apply(corr_final.dataframe, 1, function(x) !all(x==0)),]
write.xlsx(corr_final.dataframe, 'C:/Users/USER/Desktop/小型test.xlsx',rowNames=T,colNames=T)
View(corr_final)
View(corr_final.dataframe)
View(corr_final)
View(corr_final.dataframe)
library("openxlsx")
library("Hmisc")
library("tidyverse")
library("openxlsx")
library("gggene")
library("gggenes")
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARC/location_co_assembly/blastx_sm70_cover70_e10/Megan/genus/ARC-host/T5-W_ARC_classfication.xlsx")
View(data)
VF_data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARC/location_co_assembly/blastx_sm70_cover70_e10/VF_blast/T5-WVF.dmnd")
VF_data<-read.table("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARC/location_co_assembly/blastx_sm70_cover70_e10/VF_blast/T5-WVF.dmnd")
View(VF_data)
colnames(VF_data)<-c("qseqid", "gene", "pident", "length", "mismatch", "gapopen", "qstart", "qend", "sstart", "send", "evalue", "bitscore")
View(VF_data)
View(VF_data)
View(data)
View(VF_data)
View(VF_data)
View(data)
VF_data<-VF_data%>%
separate(,qseqid,sep="_",into=c("x1","x2","x3"),remove=F)
VF_data<-VF_data%>%
separate(qseqid,sep="_",into=c("x1","x2","x3"),remove=F)
VF_data<-unite(VF_data,"contig",x1,x2,sep="_")
VF_data$x3<-NULL
View(VF_data)
View(data)
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
library(ggplot2)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
data1<-data1[-(1:3),]
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#BEBADA",size=3)+geom_smooth(method="lm",color="#BEBADA")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
summary(lm(total_arg ~ core_arg, data=data1))
cor.test(data1$core_arg,data1$total_arg,method="pearson")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
View(data_core1)
View(data_core)
View(data)
data_core_percentenge<-(data_core_sum/data_sum)
data_core_percentenge
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#BEBADA",size=3)+geom_smooth(method="lm",color="#BEBADA")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
data_other<-1-data_core_percentage
data_other<-1-(data_core_percentenge)
plotdata<-as.data.frame(rbind(`Core ARGs`=data_core_sum,`Other ARGs`=data_other))
View(plotdata)
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_sum,`Other ARGs`=data_other))
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_sum,`Other ARGs`=data_other)))
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_sum,`Other ARGs`=data_other)))
View(plotdata)
spread(plotdata,key="type",value ="amount")
View(plotdata)
gather(plotdata,plotdata$`Core ARGs`,plotdata$`Other ARGs`,na.rm=T)
gather(plotdata,`Core ARGs`,`Other ARGs`)
gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
plotdata<-gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
plotdat$sample<-rownames(plotdata)
plotdata$sample<-rownames(plotdata)
View(plotdata)
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_sum,`Other ARGs`=data_other)))
View(plotdata)
plotdata$sample<-rownames(plotdata)
View(plotdata)
plotdata<-gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
View(plotdata)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")
plotdata<-as.data.frame(t(rbind(`Core ARGs`=data_core_percentenge,`Other ARGs`=data_other)))
plotdata$sample<-rownames(plotdata)
plotdata<-gather(plotdata,type,amount,`Core ARGs`,`Other ARGs`)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
summary(lm(total_arg ~ core_arg, data=data1))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#80B1D3")
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+
labs(x=NULL,y=NULL)+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
display.brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#FB8072")
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
color<-c( "#BEBADA","#FB8072")
color<-c( "#80B1D3","#8DD3C7")
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.8,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
brewer.pal(n=12,name="Set3")
display.brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#8DD3C7")
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
color<-c( "#BEBADA","#80B1D3")
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.85,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=type,color=type),alpha=0.8,stat="identity")+scale_fill_manual(values = color)+scale_color_manual(values = color)+theme_bw()+labs(x="Sample",y="Relative abundance")+theme(axis.title = element_text(size=12.5),legend.title= element_text(size=12.5),legend.text = element_text(size=12.5))
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=2,rowNames=T,colNames =T)
data$sum<-apply(data,1,sum)
data<-data%>%
arrange(desc(sum))
data$sum<-NULL
data_other<-data[-(1:11),]
others<-apply(data_other,2,sum)
data<-data[(1:11),]
data<-rbind(data,others)
rownames(data)[nrow(data)]<-"others"
data$`ARGs type`<-rownames(data)
data$`ARGs type`<-factor(data$`ARGs type`,levels = c("aminoglycoside","bacitracin","beta-lactam","fosfomycin","macrolide-lincosamide-streptogramin","multidrug","rifamycin","sulfonamide","tetracycline","unclassified","vancomycin","others"),labels = c("Aminoglycoside","Bacitracin","Beta-lactam","Fosfomycin","MLS","Multidrug","Rifamycin","Sulfonamide","Tetracycline","Unclassified","Vancomycin","Others"))
plotdata<-data%>%
gather(key="sample",value="amount",1:15)
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=`ARGs type`,color=`ARGs type`),stat="identity",alpha=0.9)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization against 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=`ARGs type`,color=`ARGs type`),stat="identity",alpha=0.7)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization against 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=`ARGs type`,color=`ARGs type`),stat="identity",alpha=0.8)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization against 16S")+theme_bw()
ggplot(plotdata)+
geom_bar(aes(x=sample,y=amount,fill=`ARGs type`,color=`ARGs type`),stat="identity",alpha=0.85)+
labs(x=NULL,y=NULL)+scale_fill_brewer(palette = "Set3")+scale_color_brewer(palette = "Set3")+theme(axis.title = element_text(size=13),axis.text = element_text(size=13),legend.title= element_text(size=12),legend.text = element_text(size=12))+theme_bw()+xlab("Sample")+ylab("ARGs abundance normalization against 16S")+theme_bw()
library(openxlsx)
library(tidyverse)
#這是一個提
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/genus_rel_table.xlsx",sheet=1,rowNames=F,colNames=T,sep.names=" ")
View(dbpata)
View(dbpata)
View(dbpata)
dbpata<-dbpata[,-(1:5)]
dbpata<-dbpata[,-7]
View(dbpata)
#這是一個提
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/genus_rel_table.xlsx",sheet=1,rowNames=F,colNames=T,sep.names=" ")
dbpata<-dbpata[,-(1:5)]
dbpata<-dbpata[,-2]
View(dbpata)
#dbpata<-as.data.frame(t(dbpata))
output<- vector(mode = "list")
#第一個回圈可以計算各別sample
for (i in 2:length(colnames(dbpata))){
list1<-dbpata%>%
filter(dbpata[,i]!=0)
list1<-list1[,1]%>%
as.data.frame()
output<-c(output,list1)
}
View(list1)
View(output)
x<-colnames(dbpata)[2:16]
names(output)<-x
output2<- vector(mode = "list")
#此回圈用於計算各組sample所有>0.005的總和(本質上在計算三重複各個sample出現所有人有誰，剔除重複)
for(i in seq(1,15,by =3)){
list1<-as.data.frame(unique(c(output[[i]],output[[i+1]],output[[i+2]])))
output2<-c(output2,list1)
}
names(output2)<-c("Raw","Finished","Upstream","Midstream","Downstream")
write.xlsx(output2,file="c:/Users/USER/Desktop/TAXA Occurance.xlsx")
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.csv("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/venn/genus venn csv")
library(openxlsx)
library(tidyverse)
library(RColorBrewer)
library(ggplot2)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.csv("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/venn/genus venn csv")
data_core<-read.csv("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/venn/genus venn lis.csv")
View(data_core)
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.csv("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/venn/genus_venn_xlsx.xlsx")
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/venn/genus_venn_xlsx.xlsx")
View(data_core)
View(data_core)
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
View(data_core1)
data_taxa<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/genus_rel_table.xlsx",sheet=1,rowNames=F,colNames =T)
View(data_taxa)
View(data_core1)
View(data_taxa)
data_taxa<-data_taxa[,-(1:5)]
View(data_taxa)
data_taxa<-data_taxa[,-2]
colnames(data_core1)<-c("Genus","core")
View(data_core1)
data_core<-merge(data,data_core1,all.y = T,by=("Genus"))
data_core<-merge(data,data_core1,all.y = T,by="Genus")
View(data_taxa)
View(data_core1)
View(data_taxa)
data_core<-merge(data_taxa,data_core1,all.y = T,by="Genus")
View(data_core)
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
View(data1)
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data_taxa[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
View(data1)
View(data_core)
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data_taxa[,2:16],2,sum)
data1<-as.data.frame(cbind(total_taxa=data_sum,core_taxa=data_core_sum))
View(data1)
View(data1)
ggplot(data = data1,aes(x=core_taxa,y=total_taxa))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
data1<-data1[-(1:3),]
ggplot(data = data1,aes(x=core_arg,y=total_arg))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
summary(lm(total_arg ~ core_arg, data=data1))
cor.test(data1$core_arg,data1$total_arg,method="pearson")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
color<-c( "#BEBADA","#80B1D3")
data_core_percentenge<-(data_core_sum/data_sum)
data_taxa<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/genus_rel_table.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/venn/genus_venn_xlsx.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
data_taxa<-data_taxa[,-(1:5)]
data_taxa<-data_taxa[,-2]
colnames(data_core1)<-c("Genus","core")
data_core<-merge(data_taxa,data_core1,all.y = T,by="Genus")
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data_taxa[,2:16],2,sum)
data1<-as.data.frame(cbind(total_taxa=data_sum,core_taxa=data_core_sum))
View(data1)
data.matrix<-as.data.frame(cbind(data1$core_taxa,data_core_percentenge))
View(data.matrix)
data.matrix<-as.data.frame(cbind(core_taxa=data1$core_taxa,data_core_percentenge))
View(data.matrix)
ggplot(data = data.matrix,aes(x=core_taxa,y=data_core_percentenge))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
summary(lm(data_core_percentenge ~ core_taxa, data=data.matrix))
cor.test(data.matrix$core_taxa,data.matrix$data_core_percentenge,method="pearson")
cor.test(data.matrix$core_taxa,data.matrix$data_core_percentenge,method="spearman")
cor.test(data.matrix$core_taxa,data.matrix$data_core_percentenge,method="pearson")
display.brewer.pal(n=12,name="Set3")
brewer.pal(n=12,name="Set3")
ggplot(data = data1,aes(x=core_taxa,y=total_taxa))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data = data.matrix,aes(x=core_taxa,y=data_core_percentenge))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "Total ARGs abundnace aganists 16S",x="Core ARGs abundnace aganists 16S") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
ggplot(data = data.matrix,aes(x=core_taxa,y=data_core_percentenge))+
geom_point(color="#8DD3C7",size=3)+geom_smooth(method="lm",color="#8DD3C7")+theme_bw()+
labs(y = "core ARGs Relative Abundnace ",x="Core Genus Relative abundnace") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
brewer.pal(n=12,name="Set3")
display.brewer.pal(n=12,name="Set3")
ggplot(data = data.matrix,aes(x=core_taxa,y=data_core_percentenge))+
geom_point(color="#BEBADA",size=3)+geom_smooth(method="lm",color="#BEBADA")+theme_bw()+
labs(y = "core ARGs Relative Abundnace ",x="Core Genus Relative abundnace") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
#這是一個提
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/species_rel_table.xlsx",sheet=1,rowNames=F,colNames=T,sep.names=" ")
#dbpata<-as.data.frame(t(dbpata))
dbpata<-dbpata[,-(1:7)]
View(dbpata)
#這是一個提
dbpata<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/species_rel_table.xlsx",sheet=1,rowNames=F,colNames=T,sep.names=" ")
#dbpata<-as.data.frame(t(dbpata))
dbpata<-dbpata[,-(1:6)]
output<- vector(mode = "list")
#第一個回圈可以計算各別sample
for (i in 2:length(colnames(dbpata))){
list1<-dbpata%>%
filter(dbpata[,i]!=0)
list1<-list1[,1]%>%
as.data.frame()
output<-c(output,list1)
}
x<-colnames(dbpata)[2:16]
names(output)<-x
output2<- vector(mode = "list")
#此回圈用於計算各組sample所有>0.005的總和(本質上在計算三重複各個sample出現所有人有誰，剔除重複)
for(i in seq(1,15,by =3)){
list1<-as.data.frame(unique(c(output[[i]],output[[i+1]],output[[i+2]])))
output2<-c(output2,list1)
}
names(output2)<-c("Raw","Finished","Upstream","Midstream","Downstream")
write.xlsx(output2,file="c:/Users/USER/Desktop/species_occurance.xlsx")
data_taxa<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/species_rel_table.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/Species_venn/species_jvenn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
View(data_taxa)
View(data_core)
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
View(data_core)
data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core$`Raw|Finsihed|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
View(data_core1)
View(data_core)
View(data_core1)
View(data_taxa)
View(data_core1)
data_taxa<-data_taxa[,-(1:6)]
View(data_taxa)
colnames(data_core1)<-c("Species","core")
data_core<-merge(data_taxa,data_core1,all.y = T,by="Species")
View(data_core)
data_core_sum<-apply(data_core[,2:16],2,sum)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_sum<-apply(data[,2:16],2,sum)
data1<-as.data.frame(cbind(total_arg=data_sum,core_arg=data_core_sum))
View(data1)
View(data_core)
View(data1)
View(data)
data_core_sum<-apply(data_core[,2:16],2,sum)
View(data_core)
data<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/ARGoap_out.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/ARG/plot/venn/ARG_venn.xlsx")
data_core1<-data_core$`Raw|Finished|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
colnames(data_core1)<-c("ARGs.abundance.normalization.aganist.16S","core")
data_core<-merge(data,data_core1,all.y = T,by=("ARGs.abundance.normalization.aganist.16S"))
data_core_sum<-apply(data_core[,2:16],2,sum)
data_taxa<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/species_rel_table.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/Species_venn/species_jvenn.xlsx")
data_core1<-data_core$`Raw|Finsihed|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
data_taxa<-data_taxa[,-(1:6)]
data_taxa<-data_taxa[,-2]
colnames(data_core1)<-c("Species","core")
data_core<-merge(data_taxa,data_core1,all.y = T,by="Species")
View(data_core)
data_core_sum1<-apply(data_core[,2:16],2,sum)
View(data_core)
data_core_sum1<-apply(data_core[,2:16],2,sum)
View(data_core)
data_taxa<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/rel abundance table/species_rel_table.xlsx",sheet=1,rowNames=F,colNames =T)
data_core<-read.xlsx("C:/Users/USER/Desktop/lab/實驗/Metagenomic in DWDS/DATA/newDATA/TAXA/plot/Species_venn/species_jvenn.xlsx")
data_core1<-data_core$`Raw|Finsihed|Upstream|Midstream|Downstream`
data_core1<-data_core1[!is.na(data_core1)]
data_core1<-as.data.frame(cbind(data_core1,rep(1,26)))
data_taxa<-data_taxa[,-(1:6)]
colnames(data_core1)<-c("Species","core")
data_core<-merge(data_taxa,data_core1,all.y = T,by="Species")
data_core_sum1<-apply(data_core[,2:16],2,sum)
data_core_sum_pre<-(data_core_sum/data_sum)
data1<-as.data.frame(cbind(core_taxa_pre=data_core_sum1,core_arg_precent=data_core_sum))
View(data1)
data1<-as.data.frame(cbind(core_taxa_pre=data_core_sum1,core_arg_precent=data_core_sum_pre))
View(data1)
View(data1)
ggplot(data = data1,aes(x=core_taxa_pre,y=data_core_arg_precent))+
geom_point(color="#BEBADA",size=3)+geom_smooth(method="lm",color="#BEBADA")+theme_bw()+
labs(y = "core ARGs Relative Abundnace ",x="Core Genus Relative abundnace") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
View(data1)
ggplot(data = data1,aes(x=core_taxa_pre,y=core_arg_precent))+
geom_point(color="#BEBADA",size=3)+geom_smooth(method="lm",color="#BEBADA")+theme_bw()+
labs(y = "core ARGs Relative Abundnace ",x="Core Genus Relative abundnace") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
View(data1)
summary(lm(core_arg_precent ~ core_taxa_pre, data=data1))
cor.test(data1$core_taxa_pre,data1$core_arg_precent,method="pearson")
cor.test(data1$core_taxa_pre,data1$core_arg_precent,method="spearman")
ggplot(data = data1,aes(x=core_taxa_pre,y=core_arg_precent))+
geom_point(color="#BEBADA",size=3)+geom_smooth(method="lm",color="#BEBADA")+theme_bw()+
labs(y = "core ARGs Relative Abundnace ",x="Core Species Relative abundnace") +theme(axis.title = element_text(size=13),axis.text =element_text(size=12.5)  ,legend.title= element_text(size=12),legend.text = element_text(size=12))
